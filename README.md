# First Nucleo project
Project shows initial project setup for a simple blinky program using FreeRTOS project generated by STM32CubeMX and modified to build using CMake and Ninja with ARM GCC.
Build target is the ST Nucleo-F446RE.
## Requirements
### VS Code
Build and debug tasks are specified for use with VSCode.
### GCC (arm-none-eabi) installed in a known location
For compiler and GDB tools
### CMake
To generate Ninja build
Added to system path
### Ninja (or Make, Ninja is used in this project)
To build the project
Added to system path
### OpenOCD
For debugging
Added to system path
### STM32CubeMX
To generate initial project files. 

## Setup
The following steps can be followed to modify this project for use in your own environment. 
Alternatively copy the CMake and .vscode/ files and modify for use if using a different controller or project generated by STM32CubeMX
1. Generate initial code from CubeMX as a Makefile project
1. Modify `arm-none-eabi-gcc.cmake` with the location of your GCC binary install location
1. In CMakeLists.txt, modify `CORE_SRC` `DRIVER_SRC` and `ASM_SRC` to include the generated source files.
    * All source files located the in `Core/Src/` directory will added and built automatically
1. Also in CMakeLists.txt, modify the following with the desired values and flags. Defaults can be found in the Makefile generated by CubeMX
    * `target_compile_definitions`
    * `target_include_directories`
    * `target_compile_options`
    * `target_link_options`
1. Create ./build/ directory to contain build artifacts
1. Create the .vscode directory and copy those files in then run the following tasks in order to build:
    1. `Configure CMake` - Only required before first build or if `CMakeLists.txt` or `arm-none-eabi-gcc.cmake` files are modified
    1. `Build (Ninja)` - Is set as the default buid task, does NOT automatically run CMake configure.

The final program will be located at ${workspaceRoot}/build/

## Programming
One option available to program the board is program via OpenOCD + GDB

1. Build the program
1. Run the `Start OpenOCD Server` task
1. Start debugging in VSCode
1. In the `Debug Console` run the following replacing `<project_path>` with your project path `-exec load <project_path>/build/FirstNucleo.elf`

## Debugging
Skip to step 3 if board was programmed as described above.
1. Program the board using the command above or STM32CubeProgrammer (or other desired program)
1. If not already running start the `Start OpenOCD Server` task - This task will continue to run until killed, you will need to stop this task to program the controller again.
1. Start debugging in VSCode


# References
https://mcuoneclipse.com/2021/05/01/visual-studio-code-for-c-c-with-arm-cortex-m-part-1/ - Parts 1-5